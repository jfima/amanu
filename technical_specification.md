# Техническое задание: AI Audio Processor (Gemini Native)

## 1. Цель проекта
Создать легковесную автономную утилиту для автоматической обработки аудиозаписей (лекции, встречи, заметки).
**Ключевая особенность**: Архитектура "AI Native". Мы отказываемся от сложного кода (разбивка на чанки, локальная диаризация) в пользу мультимодальных возможностей **Gemini 1.5 Flash** (длинный контекст, нативная работа с аудио).

## 2. Среда выполнения
*   **ОС**: Linux (Ubuntu) внутри **WSL** (Windows Subsystem for Linux).
*   **Язык**: Python 3.10+.
*   **Зависимости**: `ffmpeg` (установлен в системе), `google-generativeai`, `watchdog`, `pyyaml`.

## 3. Алгоритм работы
1.  **Мониторинг**: Скрипт следит за папкой `./input` на предмет появления новых `.mp3` файлов.
2.  **Препроцессинг (FFmpeg)**:
    *   Конвертация исходного файла в формат **Opus (OGG)**.
    *   Параметры: `16kHz`, `mono`, `24kbps` (экстремальное сжатие для быстрой загрузки, ~10Мб/час).
3.  **Обработка (Gemini API)**:
    *   Загрузка сжатого файла через Gemini File API.
    *   Единый запрос к модели (Gemini 1.5 Flash) с промптом, требующим:
        *   Транскрибацию с таймкодами и разделением по спикерам.
        *   Структурированное саммари (тезисы, участники).
4.  **Сохранение**:
    *   Результаты складываются в `./results/YYYY/MM/HHMMSS-filename/`.
    *   Сохраняются: сжатое аудио, сырой транскрипт, структурированный MD, лог.
5.  **Очистка**: Исходный файл перемещается в `processed` (или удаляется), временные файлы стираются.

## 4. Требования к входу и выходу

### Вход
*   Папка `./input`.
*   Файлы: `*.mp3` (длительность обычно до 2 часов).

### Выход
Папка `./results/2024/11/143000-lecture_01/`:
*   `compressed.ogg` - сжатая версия аудио.
*   `raw_transcript.md` - полный текст: `[MM:SS] Speaker A: Text...`.
*   `structured.md` - красивый Markdown с заголовками, буллетами и саммари.
*   `session.log` - лог процесса обработки конкретного файла. Включает статистику: затраченное время, количество токенов (input/output) и примерная стоимость операции.

## 5. Конфигурация (config.yaml)
```yaml
paths:
  input: "./input"
  results: "./results"
  quarantine: "./quarantine"

gemini:
  api_key: "YOUR_KEY"
  model: "gemini-1.5-flash"

audio:
  format: "ogg"
  bitrate: "24k"

daemon:
  poll_interval: 5
```

## 6. Детали реализации (Промпт)
Промпт должен быть составным, чтобы за один проход получить два типа данных, либо скрипт должен делать два запроса к одному загруженному файлу (File API позволяет переиспользовать файл).
**Рекомендация**: Делать один детальный запрос или два последовательных (Raw -> Structured), пока файл активен в кэше Gemini.

## 7. Критерии успеха
*   Код чистый и поддерживаемый (строгого лимита на количество строк нет).
*   Скорость: 1 час аудио обрабатывается и загружается за 1-2 минуты.
*   Точность: Спикеры определяются корректно благодаря контексту модели.
